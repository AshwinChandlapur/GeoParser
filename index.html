<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <title></title>
    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <![endif]-->
	
    <link href="static/css/bootstrap.css" rel="stylesheet" />
	<link href="static/css/bootstrap-glyphicons.css" rel="stylesheet" />
    <link href="static/css/style.css" rel="stylesheet" />
	<link rel="stylesheet" href="static/css/ol.css" type="text/css">

    <script src="static/js/jquery.js"></script>
	<script src="static/js/ol.js" type="text/javascript"></script>

  </head>
  <body>
	<div class="container-fluid full_height">

	  <nav class="navbar navbar-default" id="navbar">
		<div class="container-fluid">
		  <div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			  <span class="sr-only">Toggle navigation</span>
			  <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#"><p>Memex GeoParser</p></a>
		  </div>
		</div>
	  </nav>

	  <div class="row full_height">
		<div class="col-md-3 main_height" id="sidebar">
		  <div class="row">
			<form action="" method=post enctype=multipart/form-data>
			  <div class="col-md-12" id="upload_button">
				<input type=file name=file id="file_input">
				<button type="submit" value=Upload class="btn btn-primary">Upload a File</button>
			  </div>
			</form>
			<div class="col-md-12" id="uploaded_files">
			  <h1 id="steps">Parsed Files</h1>
			  			<div class="col-md-12" id="start_button">
			  <button type="button" class="btn btn-primary" onclick="start()">Start Parsing</button>
			</div>
			  
<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  {% for file in uploaded_files %}
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="heading_{{file}}">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse_{{file}}" aria-expanded="true" aria-controls="collapse_{{file}}">
          {{file|truncate(10, True)}}<span class="status" id="{{file}}"></span>
        </a>
      </h4>
    </div>
    <div id="collapse_{{file}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading_{{file}}">
      <div class="panel-body">
        <input type="checkbox" aria-label="...">asasd<br>
		<input type="checkbox" aria-label="...">asasd<br>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

			</div>
		  </div>
		</div>
		<div class="col-md-9 main_height" id="map">
		  <div id="map"></div>
		</div>
	  </div>

	</div>

	<!-- Javascript code -->
	<script type="text/javascript">
	  {% for file in uploaded_files%}
		document.getElementById("{{file}}").innerHTML = '<span id="numFound"></span><span id="remove" onclick="window.location.href=\'/remove/{{file}}\'">remove</span>'
	  {% endfor %}
	function start() {
	  {% for file in uploaded_files%}
	    $.getJSON('/extract_text/'+'{{file}}',function(data) {
		  document.getElementById("{{file}}").innerHTML = '<span>Text Extracted</span><img src="static/img/loading.gif" id="loading">'
		  });
		$.getJSON('/find_loc_name/'+'{{file}}',function(data){
		  document.getElementById("{{file}}").innerHTML = '<span>Locations Found</span><img src="static/img/loading.gif" id="loading">'
			});
		$.getJSON('/find_lat_lon/'+'{{file}}',function(data){});
		$.getJSON('/create_geojson/'+'{{file}}',function(data){});
	location.reload();
	  {% endfor %}
	}

	var layerOSM = new ol.layer.Tile({
                source: new ol.source.OSM(),
                name: 'OpenStreetMap'
            });
	var layerMQ = new ol.layer.Tile({
		source: new ol.source.MapQuest({
			layer: 'osm'
		}),
		name: 'MapQuest'
	});
	var layerStamenWater = new ol.layer.Tile({
		source: new ol.source.Stamen({
			layer: 'watercolor'
		}),
		name: 'Watercolor'
	});
	var layerStamenTerrain = new ol.layer.Tile({
		source: new ol.source.Stamen({
			layer: 'terrain'
		}),
		name: 'Terrain'
	});

	  var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.MapQuest({layer: 'sat'})
          })
        ],
        view: new ol.View({
          center: ol.proj.transform([0, 0], 'EPSG:4326', 'EPSG:3857'),
          zoom: 3
        })
      });



	  {%for json in json_files %}
	  var json_{{loop.index}} = new ol.layer.Vector({
	  source: new ol.source.Vector({
		url: '{{json}}',
		format: new ol.format.GeoJSON()
	  }),
	  style: new ol.style.Style({
		image: new ol.style.Circle({
		  radius: 4,
		  fill: new ol.style.Fill({color: 'red'})
		})
	  })
	});
	   map.addLayer(json_{{loop.index}});
	{% endfor %}
	</script>

	<!-- JS Files -->
	<script src="static/js/bootstrap.js"></script>
	<!-- JS Files -->

  </body>
</html>